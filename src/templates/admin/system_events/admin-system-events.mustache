<section class="tlp-framed-vertically">

<h1 class="tlp-framed-horizontally">{{ title }}</h1>

<div id="admin-system-events">
    <nav class="tlp-tabs" id="system-events-tabs">
        {{# queue_links }}
        <a href="{{ href }}" class="tlp-tab {{# active }}tlp-tab-active{{/ active }}">{{ label }}</a>
        {{/ queue_links }}
    </nav>

    <section class="tlp-framed-horizontally" id="systemevents">
        {{# search }}
            <section class="tlp-pane" id="systemevents-filter">
                <div class="tlp-pane-container">
                    <div class="tlp-pane-header">
                        <h1 class="tlp-pane-title">
                            <i class="fa fa-search tlp-pane-title-icon"></i> {{ filter_label }}
                        </h1>
                    </div>
                    <form action="" method="GET" class="tlp-pane-section">
                        <div class="tlp-form-element">
                            <label class="tlp-label" for="status">{{ status_label }}</label>
                            <select class="tlp-select" id="status" name="filter_status[]" multiple size="5">
                                {{# status }}
                                    <option value="{{ value }}" {{# checked }}selected{{/ checked }}>
                                        {{ label }}
                                    </option>
                                {{/ status }}
                            </select>
                        </div>

                        <div class="tlp-form-element">
                            <label class="tlp-label" for="types">{{ types_label }}</label>
                            <select class="tlp-select" id="types" name="filter_type[]" multiple size="5">
                                {{# types }}
                                    <option value="{{ value }}" {{# checked }}selected{{/ checked }} title="{{ label }}">
                                        {{ label }}
                                    </option>
                                {{/ types }}
                            </select>
                        </div>

                        <button type="submit" name="filter" class="tlp-button-primary tlp-button-wide">
                            <i class="fa fa-search tlp-button-icon"></i> {{ search_label }}
                        </button>
                    </form>
                </div>
            </section>
        {{/search}}

        <section class="tlp-pane" id="systemevents-results">
            <div class="tlp-pane-container">
                <div class="tlp-pane-header">
                    <h1 class="tlp-pane-title">
                        <i class="fa fa-flag tlp-pane-title-icon"></i> {{ title }}
                    </h1>
                </div>
                <section class="tlp-pane-section">
                    <table class="tlp-table">
                        <thead>
                            <tr>
                                <th>{{ type_label }}</th>
                                <th>{{ status_label }}</th>
                                <th>{{ parameters_label }}</th>
                                <th class="tlp-table-cell-numeric">{{ time_taken_label }}</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {{# events }}
                                <tr>
                                    <td>
                                        {{# namespace }}
                                            <div class="systemevents-namespace">{{ namespace }}</div>
                                        {{/ namespace }}
                                        {{ type }}
                                    </td>
                                    <td>
                                        <div class="tlp-badge-{{ badge }}
                                            {{^ status_need_attention }}tlp-badge-outline{{/ status_need_attention }}"
                                        >
                                            {{ status }}
                                        </div>
                                    </td>
                                    <td>
                                        {{{ purified_parameters }}}
                                    </td>
                                    <td class="tlp-table-cell-numeric">{{ time_taken }}</td>
                                    <td class="tlp-table-cell-actions">
                                        <form action="/admin/system_events/" method="POST">
                                            {{# csrf }}
                                                {{> csrf_token_input }}
                                            {{/ csrf }}
                                            <input type="hidden" name="queue" value="{{ queue }}">
                                            {{# can_be_replayed }}
                                                <button type="submit"
                                                    name="replay"
                                                    value="{{ id }}"
                                                    class="tlp-button-primary tlp-button-outline tlp-button-small tlp-table-cell-actions-button"
                                                >
                                                    <i class="fa fa-repeat tlp-button-icon"></i> {{ replay_label }}
                                                </button>
                                            {{/ can_be_replayed }}
                                            <button type="button"
                                                class="tlp-button-primary tlp-button-outline tlp-button-small tlp-table-cell-actions-button systemevents-display-edit-modal"
                                                data-modal-id="systemevents-details-modal-{{ id }}"
                                            >
                                                <i class="fa fa-list tlp-button-icon"></i> {{ details_label }}
                                            </button>
                                        </form>

                                        {{> modal-details-system-event }}
                                    </td>
                                </tr>
                            {{/ events }}
                            {{^ has_events }}
                                <tr>
                                    <td colspan="5" class="tlp-table-cell-empty">
                                        {{ empty_state }}
                                    </td>
                                </tr>
                            {{/ has_events }}
                        </tbody>
                    </table>
                    {{# has_events }}
                        {{# pagination }}
                            {{> pagination }}
                        {{/ pagination }}
                    {{/ has_events }}
                </section>
            </div>
        </section>
    </section>

    <form action="" method="POST" class="tlp-framed-horizontally">
        {{# csrf }}
            {{> csrf_token_input }}
        {{/ csrf }}
        <h3>{{ notification_title }}</h3>

        {{{ send_mail_section_title }}}

        {{^ has_follower }}
            <em>{{ nobody_label }}</em>
        {{/ has_follower }}

        <table class="tlp-table">
            <thead>
                <tr><th>emails</th><th>listen</th><th>&nbsp;</th></tr>
            </thead>
            <tbody>

            {{# system_event_followers }}
                <tr valign="top"><td>
                {{# edit }}
                    <textarea name="followers[{{ id }}][emails]" rows="4" cols="40">
                        {{ email }}
                    </textarea>
                {{/ edit }}

                {{^ edit }}
                    {{ email }}
                {{/ edit }}

                </td><td>

                {{# edit }}
                    <select name="followers[{{ id }}][types][]" size="5" multiple="multiple">
                    {{# types-selected }}
                        <option value="{{ label }}" {{# selected }} selected="selected" {{/ selected }}>
                            {{ label }}
                        </option>
                    {{/ types-selected }}
                    </select>
                {{/ edit }}

                {{^ edit }}
                    {{ types }}
                {{/ edit }}

                </td><td>

                {{# edit }}
                    <input type="submit" class="tlp-button-primary" name="save" value="{{ btn_submit_label }}" />
                    <input type="submit" class="tlp-button-secondary" name="cancel" value="{{ btn_cancel_label }}" />
                {{/ edit }}

                {{^ edit }}
                    <a href="?edit={{ id }}&queue={{ queue }}">{{{ edit_icon }}}</a>
                {{/ edit }}

                <a class="remove_followers" href="?queue={{ queue }}&delete={{ id }}" data-message="{{ js_content }}"> {{{ cross_icon }}} </a>
                </td></tr>

                {{/ system_event_followers }}

                {{^ request_is_edit }}
                    <tr valign="top"><td>
                    <textarea name="new_followers[emails]" id="new_followers_email" rows="4" cols="40" placeholder="{{ default_new_followers_email }}"></textarea>
                    </td><td>
                    <select name="new_followers[types][]" size="5" multiple="multiple">
                        {{# status_new_followers }}
                            <option value="{{ label }}"> {{ label }} </option>
                        {{/ status_new_followers }}
                    </select>
                    </td><td>
                    <input type="submit" class="tlp-button-secondary" value="{{ btn_submit_label }}" />
                    </td></tr>'
                {{/ request_is_edit }}

            </tbody>
        </table>
    </form>
</div>

</section>
