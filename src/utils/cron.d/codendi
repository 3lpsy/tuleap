#
# -- WARNING -- WARNING -- WARNING -- WARNING -- WARNING -- WARNING --
# ------------------  EDIT THE CORRECT FILE  -------------------------
#
# This file is copied to /etc/cron.d/codendi from
# /usr/share/codendi/src/utils/cron.d/codendi when the codendi service is started via its
# init.d script and the file /etc/cron.d/codendi is removed when the
# service is stopped.  Therefore any edits made directly to
# /etc/cron.d/codendi will be lost anytime the codendi service
# restarts.
#
# To make changes edit the master copy /usr/share/codendi/src/utils/cron.d/codendi and then
# restart the service to pick up the changes (/sbin/service codendi restart).
#
# The reason this is done this way is because the codendi cron jobs
# should only be invoked if the codendi service is enabled and not
# just as a consequence of installing the rpm as was the case
# previously. The file /etc/cron.d/codendi cannot simply be linked to
# the master copy in /usr/share/codendi/src/utils/cron.d/codendi because for security reasons cron
# will not process crontab files that are links or writeable by
# anybody else but root, thus the file must be copied into /etc/cron.d
# with the right ownership and permissions.

#
# Codendi root
#

# Once a minute, process Codendi system events
* * * * * root (cd /usr/share/codendi/src/utils; ./php-launcher.sh ./process_system_events.php)

#
# Regularly launch a system_check event (e.g. every half-hour)
0,30 * * * * root (cd /usr/share/codendi/src/utils; ./php-launcher.sh ./launch_system_check.php)

#
# run the daily statistics script just a little bit after
# midnight so that it computes stats for the day before
# Run at 0:30 am
30 0 * * * root /usr/share/codendi/src/utils/compute_all_daily_stats.sh 2>&1 >/dev/null

#
# run the weekly stats for projects. Run it on Monday morning so that
# it computes the stats for the week before
# Run on Monday at 1am
0 1 * * Mon root (cd /usr/share/codendi/src/utils/underworld-root; ./db_project_weekly_metric.pl 2>&1 >/dev/null)

# BKP: too keep in root crontab (because root can choose to use it or not, per site)
# daily incremental backup of subversion repositories
#45 23 * * 1-6 root /usr/lib/codendi/bin/backup_subversion.sh -i

# BKP: too keep in root crontab (because root can choose to use it or not, per site)
# weekly full backup of subversion repositories (0:15 on Sunday)
#15 0 * * Sun root /usr/lib/codendi/bin/backup_subversion.sh -noarchives

# BKP: too keep in root crontab (because root can choose to use it or not, per site)
# weekly backup preparation (mysql shutdown, file dump and restart)
#45 0 * * Sun root /usr/lib/codendi/bin/backup_job -noarchives 2>&1 >/dev/null

# Delete all files in FTP incoming that are older than 2 weeks (336 hours)
#
0 3 * * * root /usr/sbin/tmpwatch -m -f 336 /var/lib/codendi/ftp/incoming

#
# It looks like we have memory leaks in Apache in some versions so restart it
# on Sunday. Do it while the DB is down for backup
50 0 * * root Sun /sbin/service httpd restart 2>&1 >/dev/null

#
# Once a minute make sure that the setuid bit is set on some critical files
#* * * * * root (cd /usr/lib/codendi/bin; /bin/chmod u+s log_accum fileforge)

#
# Codendiadm
#

# Daily Codendi PHP cron (obsolete documents...)
10 0 * * * codendiadm /usr/share/codendi/src/utils/php-launcher.sh /usr/share/codendi/src/utils/codendi_daily.php
