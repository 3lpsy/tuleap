<?php   

//
// SourceForge: Breaking Down the Barriers to Open Source Development
// Copyright 1999-2000 (c) The SourceForge Crew
// http://sourceforge.net
//              
// $Id$


require($DOCUMENT_ROOT.'/../common/include/Error.class');

/*

	Extends the basic Error class to add HTML functions for displaying all site dependent HTML, while allowing extendibility/overriding by themes via the Theme class.

	Make sure browser.php is included _before_ you create an instance of this object.

	Geoffrey Herteg, August 29, 2000

*/



class Layout extends Error {

	//Define all the icons for this theme
	var $icons = array('Summary' => 'ic/anvil24.png',
		'Homepage' => 'ic/home.png',
		'Forums' => 'ic/notes.png',
		'Bugs' => 'ic/bug.png',
		'Support' => 'ic/support.png',
		'Patches' => 'ic/patch.png',
		'Lists' => 'ic/mail.png',
		'Tasks' => 'ic/index.png',
		'Docs' => 'ic/docman.png',
		'Surveys' => 'ic/survey.png',
		'News' => 'ic/news.png',
		'CVS' => 'ic/convert.png',
		'Files' => 'ic/save.png',
		'Trackers' => 'ic/tracker20w.png'
		);

	var $bgpri = array();

	// Constuctor
	function Layout() {
		GLOBAL $bgpri;

		// Constructor for parent class...
		$this->Error();

		/*
	        Set up the priority color array one time only
		*/
		$bgpri[1] = 'priora';
		$bgpri[2] = 'priorb';
		$bgpri[3] = 'priorc';
		$bgpri[4] = 'priord';
		$bgpri[5] = 'priore';
		$bgpri[6] = 'priorf';
		$bgpri[7] = 'priorg';
		$bgpri[8] = 'priorh';
		$bgpri[9] = 'priori';

	}

	// Box Top, equivalent to html_box1_top()
	function box1_top($title,$echoout=1,$bgcolor='',$cols=2){
        	$return = '<TABLE class="boxtable" cellspacing="1" cellpadding="5" width="100%" border="0">
                        <TR class="boxtitle" align="center">
                                <TD colspan="'.$cols.'"><SPAN class=titlebar>'.$title.'</SPAN></TD>
                        </TR>
                        <TR class="boxitem">
                                <TD colspan="'.$cols.'">';
	        if ($echoout) {
        	        print $return;
	        } else {
                	return $return;
        	}
	}

	// Box Middle, equivalent to html_box1_middle()
	function box1_middle($title,$bgcolor='',$cols=2) {
        	return '
                                </TD>
                        </TR>
    
                        <TR class="boxtitle">
                                <TD colspan="'.$cols.'"><SPAN class=titlebar>'.$title.'</SPAN></TD>
                        </TR>
                        <TR class="boxitem">
                                <TD colspan="'.$cols.'">';
	}

	// Box Bottom, equivalent to html_box1_bottom()
	function box1_bottom($echoout=1) {
        	$return = '
                </TD>
                        </TR>
        </TABLE>
';
	        if ($echoout) {
        	        print $return;
	        } else {
                	return $return;
        	}
	}

	function generic_header_start($params) {

            global $G_USER, $G_SESSION;

	        if (!$params['title']) {
        	        $params['title'] = $GLOBALS['sys_name'];
	        } else {
        	        $params['title'] = $GLOBALS['sys_name'].": " . $params['title'];
	        }
        	?>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/REC-html40/loose.dtd">

<html lang="en">
  <head>
    <TITLE><?php echo $params['title']; ?></TITLE>
        <SCRIPT language="JavaScript">
        <!--
        function help_window(helpurl) {
                HelpWin = window.open(helpurl,'HelpWindow','scrollbars=yes,resizable=yes,toolbar=no,height=640,width=800');
		HelpWin.focus();
        }
        // -->
        </SCRIPT>
    <link rel="stylesheet" type="text/css" href="<? echo util_get_css_theme(); ?>">
	<link rel="SHORTCUT ICON" href="<? echo util_get_image_theme("favicon.ico"); ?>">

<?php
	}

	function generic_header_end($params) {
	?>
   </HEAD>
<?php
	}

	function generic_footer($params) {

	        global $IS_DEBUG,$QUERY_COUNT;
        	if ($IS_DEBUG && user_ismember(1,'A')) {
	                echo "<CENTER><B><span class=\"highlight\">Query Count: $QUERY_COUNT</span></B></CENTER>";
                	echo "<P>$GLOBALS[G_DEBUGQUERY]";
        	}
	        ?>
<? include(util_get_content('layout/footer')); ?>
</body>
</html>
        <?php
	}

	function header($params) {
	
	        $this->generic_header_start($params); 

        	//themable someday?
	        $site_fonts='verdana,arial,helvetica,sans-serif';

        ?>

 	<?php
        $this->generic_header_end($params); 
?>

<body leftmargin="0" rightmargin="0" topmargin="0" bottommargin="0" marginwidth="0" marginheight="0">
<?php


/*

        OSDN NAV BAR

*/
osdn_print_navbar();

echo html_blankimage(5,100);
?>
<br>
<!-- start page body -->
<div align="center">
<table cellpadding="0" cellspacing="0" border="0" width="97%">

<!-- First line with borders and corners -->
           <tr>
               <td background="<? echo util_get_image_theme("upper_left_corner.png"); ?>" width="1%" height="26"><img src="<? echo util_get_image_theme("upper_left_corner.png"); ?>" width="16" height="26" alt=" "></td>
                <td background="<? echo util_get_image_theme("top_border.png"); ?>" align="left" colspan="3" width="99%"><a href="/"><img src="<? echo util_get_image_theme("codex_banner_lc.png"); ?>" border="0" alt="<?php echo $GLOBALS['sys_name']; ?> Banner"></a></td>
                <td><img src="<? echo util_get_image_theme("upper_right_corner.png"); ?>" width="16" height="26" alt=" "></td>
        </tr>


<!-- Second line with menus and content -->
        <tr>

                <td background="<? echo util_get_image_theme("left_border.png"); ?>" align="left" valign="bottom" alt=""><img src="<? echo util_get_image_theme("bottom_left_corner.png"); ?>" width="16" height="16" alt=""></td>

                <td colspan="3" >
<!-- start main body cell -->


        <div align="left">
        <table style=menus cellpadding="0" cellspacing="0" border="0" width="100%">

                <tr>
                    <td class="menuframe">

        <!-- VA Linux Stats Counter -->
        <?php
        if (!session_issecure()) {
                print '<IMG src="'.util_get_image_theme("clear.png").'" width=140 height=1 alt="Counter"><BR>';
        } else {
                print html_blankimage(1,140) . '<br>';
        }
        ?>


        <!-- Company Logo here -->
        <P>
	<?php
	print '<center><IMG src="'.util_get_image_theme("organization_logo.png").'" alt="'.$GLOBALS['sys_org_name'].' Logo"></center><BR>';
	?>

        <!-- menus -->
        <?php
        // html_blankimage(1,140);
        menu_print_sidebar($params);
        ?>
        <P>
        </TD>

        <td width="15" background="<? echo util_get_image_theme("fade.png"); ?>" nowrap>&nbsp;</td>
    
        <td class="contenttable">
        <BR>
<?php
	}

	function footer($params) {
        ?>
        </div>
        <!-- end content -->
        </tr>
<!-- New row added for the thin black line at the bottom of the array -->
<tr><td background="<? echo util_get_image_theme("black.png"); ?>" colspan="4" align="center"><img src="<? echo util_get_image_theme("clear.png"); ?>" width="2" height="2" alt=" "></td> </tr>
        </table>

                </td>

                <td background="<? echo util_get_image_theme("right_border.png"); ?>" valign="bottom"><img src="<? echo util_get_image_theme("bottom_right_corner.png"); ?>" width="16" height="16" alt=" "></td>
        </tr>

</table>
</div>
<!-- themed page footer -->
<?php 
	$this->generic_footer($params);
	}



	function menuhtml_top($title) {
        	/*
                	Use only for the top most menu
	        */
        ?>
<table class="menutable">
        <tr>
                <td class="menutitle"><?php echo $title; ?><br></td>
        </tr>
        <tr>
                <td class="menuitem">
        <?php
	}


	function menuhtml_bottom() {
	        /*
        	        End the table
	        */
        	print '
                        <BR>
                        </td>
                </tr>
        </table>
';
	}

	function menu_entry($link, $title) {
        	print "\t".'<A class="menus" href="'.$link.'">'.$title.'</A> &nbsp;<img src="'.util_get_image_theme("point1.png").'" alt=" " width="7" height="7"><br>';
	}

        /*!     @function tab_entry
                @abstract Prints out the a themed tab, used by project_tabs
                @param  $url is the URL to link to
			$icon is the image to use (if the theme uses it)
			$title is the title to use in the link tags
			$selected is a boolean to test if the tab is 'selected'
                @result text - echos HTML to the screen directly
        */
	function tab_entry($url, $icon='', $title='Home', $selected=0) {
        	print '
                <A ';
	        if ($selected){
        	        print 'class=tabselect ';
	        } else {
        	        print 'class=tabs ';
	        }
        	print 'href="'. $url .'">' . $title . '</A>&nbsp;|&nbsp;';
	}

	/*!     @function project_tabs
	        @abstract Prints out the project tabs, contained here in case
			we want to allow it to be overriden
	        @param 	$toptab is the tab currently selected
			$group is the group we should look up get title info
        	@result text - echos HTML to the screen directly
	*/
	function project_tabs($toptab,$group) {
		
		global $sys_activate_tracker;

        	// get group info using the common result set
	        $project=project_get_object($group);
        	if ($project->isError()) {
	                //wasn't found or some other problem
                	return;
        	}

	        print '<H2>'. $project->getPublicName() .' - ';
        	// specific to where we're at
	        switch ($toptab) {
                	case 'home': print 'Summary'; break;
        	        case 'forums': print 'Forums'; break;
	                case 'bugs': print 'Bugs'; break;
                	case 'support': print 'Support'; break;
        	        case 'mail': print 'Mailing Lists'; break;
	                case 'pm': print 'Tasks'; break;
                	case 'docman': print 'Documentation'; break;
        	        case 'surveys': print 'Surveys'; break;
	                case 'cvs': print 'CVS'; break;
                	case 'downloads': print 'Downloads'; break;
        	        case 'news': print 'News'; break;
	                case 'patch': print 'Patches'; break;
	                case 'admin': print 'Administration'; break;
	                case 'trackers': print 'Trackers'; break;
                	default: print 'Summary'; break;
        	}
        print '</H2>
        <P>
	<HR SIZE="1" NoShade>';

        	// Summary
	        $this->tab_entry('/projects/'. $project->getUnixName() .'/', $this->icons['Summary'], 'Summary', $toptab == 'home');

        	// Admin
	        $this->tab_entry('/project/admin/?group_id='.$group , $this->icons['Admin'], 'Admin', $toptab == 'admin');

        	// Homepage
	        $this->tab_entry((session_issecure() ? 'https://':'http://'). $project->getHomePage(), $this->icons['Homepage'], 'Home Page');

        	// Forums
	        if ($project->usesForum()) {
        	        $this->tab_entry('/forum/?group_id='.$group, $this->icons['Forums'], 'Forums', $toptab == 'forums');
	        }

        	// Bug Tracking
	        if ($project->usesBugs() && !($sys_activate_tracker && !$project->activateOldBug())) {
        	        $this->tab_entry('/bugs/?group_id='.$group, $this->icons['Bugs'], 'Bugs', $toptab == 'bugs');
	        }

        	// Support Tracking
	        if ($project->usesSupport() && !($sys_activate_tracker && !$project->activateOldSR())) {
        	        $this->tab_entry('/support/?group_id='.$group, $this->icons['Support'], 'Support', $toptab == 'support');
	        }

        	// Patch Manager
	        if ($project->usesPatch()) {
        	        $this->tab_entry('/patch/?group_id='.$group, $this->icons['Patches'], 'Patches', $toptab == 'patch');
	        }

        	// Mailing Lists
	        if ($project->usesMail()) {
        	        $this->tab_entry('/mail/?group_id='.$group, $this->icons['Lists'], 'Lists', $toptab == 'mail');
	        }

        	// Project Manager
	        if ($project->usesPm() && !($sys_activate_tracker && !$project->activateOldTask())) {
        	        $this->tab_entry('/pm/?group_id='.$group, $this->icons['Tasks'], 'Tasks', $toptab == 'pm');
	        }

        	// Doc Manager
	        if ($project->usesDocman()) {
        	        $this->tab_entry('/docman/?group_id='.$group, $this->icons['Docs'], 'Docs', $toptab == 'docman');
	        }

        	// Surveys
	        if ($project->usesSurvey()) {
        	        $this->tab_entry('/survey/?group_id='.$group, $this->icons['Surveys'], 'Surveys', $toptab == 'surveys');
	        }

        	//newsbytes
	        if ($project->usesNews()) {
        	        $this->tab_entry('/news/?group_id='.$group, $this->icons['News'], 'News', $toptab == 'news');
	        }

        	// CVS
	        if ($project->usesCVS()) {
                	$this->tab_entry('/cvs/?group_id='.$group, $this->icons['CVS'], 'CVS', $toptab == 'cvs');
        	}

	        // Downloads
	        $this->tab_entry('/project/filelist.php?group_id='.$group, $this->icons['Files'], 'Files', $toptab == 'downloads');

	        // Trackers
	        if ( $project->usesTracker() && $sys_activate_tracker) {
	        	$this->tab_entry('/tracker/index.php?group_id='.$group, $this->icons['Trackers'], 'Trackers', $toptab == 'trackers');
	        }

        	print '<HR SIZE="1" NoShade><P>';
	}


	}
?>
