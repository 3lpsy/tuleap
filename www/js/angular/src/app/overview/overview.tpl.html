<div id="pull-request-info">
    <div class="pull-request-details">
        <div ng-hide="overview.showEditionForm">
            <div>
                <span ng-bind-html="overview.pull_request.title"></span>
                <button class="btn btn-link btn-small" ng-click="overview.showEditionForm = true">
                    <i class="icon-edit"></i>
                </button>
            </div>
            <blockquote class="pull-request-description" ng-bind-html="overview.pull_request.description"></blockquote>
        </div>
        <form class="pull-request-edition-form" ng-show="overview.showEditionForm">
            <div>
                <input type="text" ng-model="overview.editionForm.title" placeholder="title" tabindex="10" />
                <button ng-click="overview.saveEditionForm()" class="btn btn-link btn-small" tabindex="12">
                    <i class="icon-ok"></i>
                </button>
                <button ng-click="overview.showEditionForm = false" class="btn btn-link btn-small" tabindex="13">
                    <i class="icon-remove"></i>
                </button>
            </div>
            <textarea ng-model="overview.editionForm.description" rows="5" placeholder="description" tabindex="11"></textarea>
        </form>
        <div class="pull-requests-references">
            <div>
                <span class="pull-requests-source-destination">
                    <span class="repository"
                        ng-if="! overview.pull_request.repository.isCurrent">{{ overview.pull_request.repository.name }}:
                    </span>{{ overview.pull_request.branch_src }}
                    <i class="icon-long-arrow-right"></i>
                    <span class="repository"
                        ng-if="! overview.pull_request.repository_dest.isCurrent">{{ overview.pull_request.repository_dest.name }}:
                    </span>{{ overview.pull_request.branch_dest }}
                </span>
            </div>
            <span class="pull-request-reference">{{ overview.pull_request.reference_src }}</span>
        </div>
    </div>
    <div class="pull-request-author">
        <span class="pull-request-label" translate>Requester</span>
        <div>
            <div class="avatar"><img src="{{ overview.author.avatar_url }}"></div>
            <a href="{{ overview.author.user_url }}">{{ overview.author.display_name }}</a>
        </div>
    </div>
    <div class="pull-request-date">
        <span class="pull-request-label" translate>Date</span>
        <div>{{ overview.pull_request.creation_date | date: 'short' }}</div>
    </div>
    <div class="pull-request-changes">
        <span class="pull-request-label" translate>Changes</span>
        <div>
            <span class="text-success">+{{ overview.pull_request.short_stat.lines_added }}</span>
            <span class="text-error">-{{ overview.pull_request.short_stat.lines_removed }}</span>
        </div>
    </div>
    <div>
        <span class="pull-request-label" translate>Last CI Status</span>
        <div>
            <span class="text-success" ng-if="overview.buildStatusIs('success')" translate>success on {{ overview.pull_request.last_build_date | date: 'short' }}</span>
            <span class="text-error" ng-if="overview.buildStatusIs('fail')" translate>failure on {{ overview.pull_request.last_build_date | date: 'short' }}</span>
            <span class="text-warning" ng-if="overview.buildStatusIs('unknown')" translate>unknown</span>
        </div>
    </div>
</div>

<div id="pull-request-actions">
    <div ng-if="overview.operationInProgress" class="loading"></div>

    <div ng-if="overview.isNonFastForwardMerge()">
        <button ng-if="overview.hasMergeRight()" class="btn btn-large btn-warning" ng-disabled="overview.operationInProgress" ng-click="overview.checkMerge()">
            <i class="icon-code-fork icon-rotate-270"></i> {{ 'Merge' | translate }}
        </button>
        <button ng-if="overview.hasAbandonRight()" class="btn btn-large btn-danger" ng-disabled="overview.operationInProgress" ng-click="overview.abandon()">
            <i class="icon-trash"></i> {{ 'Abandon' | translate }}
        </button>
    </div>

    <div ng-if="overview.isConflictingMerge()" class="alert alert-error">
        <i class="icon-remove-sign"></i>
        {{ 'Pull request can not be merged automatically due to conflicts with destination. Resolve conflicts on the command line and update the pull request.' | translate }}
        <p>
            <button ng-if="overview.hasMergeRight()" class="btn btn-large btn-primary" disabled="true">
                <i class="icon-code-fork icon-rotate-270"></i> {{ 'Merge' | translate }}
            </button>
            <button ng-if="overview.hasAbandonRight()" class="btn btn-large btn-danger" ng-disabled="overview.operationInProgress" ng-click="overview.abandon()">
                <i class="icon-trash"></i> {{ 'Abandon' | translate }}
            </button>
        </p>
    </div>

    <div ng-if="overview.isUnknownMerge()" class="alert alert-error">
        <i class="icon-remove-sign"></i>
        {{ 'Pull request mergeability with destination is not determined. You can merge on the command line and push to destination.' | translate }}
        <p>
            <button ng-if="overview.hasMergeRight()" class="btn btn-large btn-primary" disabled="true">
                <i class="icon-code-fork icon-rotate-270"></i> {{ 'Merge' | translate }}
            </button>
            <button ng-if="overview.hasAbandonRight()" class="btn btn-large btn-danger" ng-disabled="overview.operationInProgress" ng-click="overview.abandon()">
                <i class="icon-trash"></i> {{ 'Abandon' | translate }}
            </button>
        </p>
    </div>

    <div ng-if="! overview.isConflictingMerge() && ! overview.isUnknownMerge() && ! overview.isNonFastForwardMerge()">
        <button ng-if="overview.hasMergeRight()" class="btn btn-large btn-primary" ng-disabled="overview.operationInProgress" ng-click="overview.checkMerge()">
            <i class="icon-code-fork icon-rotate-270"></i> {{ 'Merge' | translate }}
        </button>
        <button ng-if="overview.hasAbandonRight()" class="btn btn-large btn-danger" ng-disabled="overview.operationInProgress" ng-click="overview.abandon()">
            <i class="icon-trash"></i> {{ 'Abandon' | translate }}
        </button>
    </div>

    <button ng-if="overview.pull_request.status === overview.valid_status_keys.abandon" class="btn btn-large btn-danger" disabled translate>
        Abandoned
    </button>
    <button ng-if="overview.pull_request.status === overview.valid_status_keys.merge" class="btn btn-large btn-success" disabled translate>
        Already merged
    </button>
</div>

<div ui-view="timeline"></div>
