<?php
/*
 * Copyrightï¿½ STMicroelectronics, 2006
 * Originally written by Manuel VACELET, STMicroelectronics, 2006
 *
 * This file is a part of CodeX.
 *
 * CodeX is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * CodeX is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with CodeX; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 * $Id$
 *
 */

class Docman_View_DocumentTableVisitor /* implements Visitor*/ {
    var $html;
    var $altRowClass;

    function Docman_View_DocumentTableVisitor() {
        global $Language;
        
        $this->html = html_build_list_table_top(array($Language->getText('plugin_docman', 'view_documenttablevisitor_title'),
                                                      $Language->getText('plugin_docman', 'view_documenttablevisitor_desc'),
                                                      $Language->getText('plugin_docman', 'view_documenttablevisitor_owner'),
                                                      $Language->getText('plugin_docman', 'view_documenttablevisitor_subdate'),
                                                      $Language->getText('plugin_docman', 'view_documenttablevisitor_lastauthor'),
                                                      $Language->getText('plugin_docman', 'view_documenttablevisitor_lastupdate')));
        $this->altRowClass = 0;
    }

    function visitFolder(&$item) {
        $items =& $item->getAllItems();
        if (count($items)) {             
            foreach($items as $key => $nop) {
                $items[$key]->accept($this);
            }                            
        }
    }

    function visitDocument(&$item) {
        $trclass = html_get_alt_row_color($this->altRowClass++);
        $this->html .=  "<tr class=\"".$trclass."\">\n";
            
        // Title
        $this->html .=  "<td>";
        $this->html .=  $item->getTitle();
        $this->html .=  "</td>\n";

        // Description
        $this->html .=  "<td>";
        $this->html .=  $item->getDescription();
        $this->html .=  "</td>\n";

        // Owner
        $this->html .=  "<td>";
        $this->html .=  user_getname($item->getOwnerId());
        $this->html .=  "</td>\n";

        // Submission Date
        $this->html .=  "<td>";
        $this->html .=  strftime("%e %b %Y %H:%M", $item->getCreateDate());
        $this->html .=  "</td>\n";

        // Last Author
        $this->html .=  "<td>";
        //$this->html .=  $item->getCreateDate();
        $this->html .=  "</td>\n";
            
        // Last Update
        $this->html .=  "<td>";
        $this->html .=  strftime("%e %b %Y %H:%M", $item->getUpdateDate());
        $this->html .=  "</td>\n";

        $this->html .=  "</tr>\n";
    }
    function visitWiki(&$item, $params = array()) {
        return $this->visitDocument($item, $params);
    }
    function visitLink(&$item, $params = array()) {
        return $this->visitDocument($item, $params);
    }
    function visitFile(&$item, $params = array()) {
        return $this->visitDocument($item, $params);
    }
    function visitEmbeddedFile(&$item, $params = array()) {
        return $this->visitDocument($item, $params);
    }
    
    function toHtml() {
        return $this->html."</table>\n";
    }
}

?>