<?php

/**
* Copyright (c) Xerox Corporation, CodeX Team, 2001-2005. All rights reserved
* 
* $Id$
*
* Docman_View_Admin_View
*/

require_once('Docman_View_Extra.class');
require_once('Docman_View_Browse.class');

require_once(dirname(__FILE__).'/../Docman_SettingsDao.class');
class Docman_View_Admin_View extends Docman_View_Extra {
    
    function _title($params) {
        echo '<h2>'. $this->_getTitle($params) .' - '. $GLOBALS['Language']->getText('plugin_docman', 'admin_view_title') .'</h2>';
    }
    function _content($params) {
        $html = '';
        $html .= '<p>'. $GLOBALS['Language']->getText('plugin_docman', 'admin_view_instructions') .'</p>';
        $html .= '<form action="'. $params['default_url'] .'" method="POST">';
        $html .= '<select name="selected_view" onchange="this.form.submit()">';
        $actual = false;
        $dao =& $this->_getSettingsDao();
        $dar =& $dao->searchViewByGroupId($params['group_id']);
        if ($dar && !$dar->isError() && $dar->valid()) {
            $row = $dar->current();
            $actual = $row['view'];
        }
        $views  = Docman_View_Browse::getAllViews();
        foreach($views as $view) {
            $html .= '<option value="'. $view .'" '. ($actual == $view ? 'selected="selected"' : '') .'>'. $GLOBALS['Language']->getText('plugin_docman', 'view_'.$view) .'</option>';
        }
        $html .= '</select>';
        $html .= '<input type="hidden" name="action" value="admin_change_view" />';
        $html .= '<noscript><input type="submit" value="'. $GLOBALS['Language']->getText('global', 'btn_submit') .'" /></noscript>';
        echo $html;
    }
    
    /* protected */ function _getSettingsDao() {
        return new Docman_SettingsDao(CodexDataAccess::instance());
    }
}

?>
