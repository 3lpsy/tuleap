<div class="tlp-pane-container">
    <div class="tlp-pane-header milestone-header"
        ng-click="milestoneController.toggleMilestone()"
    >
        <i class="tlp-pane-title-icon fa fa-fw"
            ng-class="{
                'fa-caret-right': milestoneController.isCollapsed(),
                'fa-caret-down': milestoneController.isExpanded(),
                'fa-spinner fa-spin': milestoneController.milestone.updating
            }"
        ></i>
        <span class="tlp-pane-title milestone-header-label">{{ milestoneController.milestone.label }}</span>

        <div class="tlp-dropdown milestone-action-button"
            ng-if="! milestoneController.milestone.collapsed && milestoneController.canUserMoveCards()"
        >
            <button type="button"
                class="tlp-button-primary tlp-button-outline tlp-button-mini"
                open-tlp-dropdown
                ng-click="$event.stopPropagation()"
            >
                <i class="fa fa-plus tlp-button-icon"></i>
                <span translate>Add item</span>
                <i class="fa fa-caret-down tlp-button-icon-right"></i>
            </button>
            <div class="tlp-dropdown-menu" role="menu">
                <a href="javascript:;"
                    ng-repeat="accepted_type in milestoneController.milestone.content_accepted_types.content"
                    ng-click="$event.stopPropagation(); planning.showAddItemToSubMilestoneModal(accepted_type, milestoneController.milestone)"
                    class="tlp-dropdown-menu-item"
                    role="menuitem"
                >{{ accepted_type.label }}</a>
            </div>
        </div>

        <div class="milestone-header-spacer"></div>

        <span class="milestone-header-dates"
            ng-if="milestoneController.milestone.start_date || milestoneController.milestone.end_date"
        >
            {{ milestoneController.milestone.start_date | amDateFormat:'ll' }}
            <i class="fa fa-long-arrow-right"></i>
            {{ milestoneController.milestone.end_date | amDateFormat:'ll' }}
        </span>
        <span class="tlp-badge-primary tlp-badge-outline milestone-header-status"
            ng-class="{'tlp-badge-secondary': milestoneController.milestone.semantic_status === 'closed' }"
        >{{ milestoneController.milestone.status_value }}</span>
    </div>

    <div class="milestone-info"
        ng-if="! milestoneController.milestone.collapsed"
    >
        <span class="tlp-badge-secondary milestone-info-badge"
            translate
            ng-if="milestoneController.milestone.capacity"
        >Capacity: {{ milestoneController.milestone.capacity }}</span>
        <span class="tlp-badge-secondary milestone-info-badge"
            translate
            ng-if="! milestoneController.milestone.capacity"
        >Capacity: N/A</span>

        <span class="milestone-info-badge"
            ng-if="milestoneController.milestone.initialEffort"
            ng-class="{
                'tlp-badge-warning': milestoneController.milestone.initialEffort > milestoneController.milestone.capacity,
                'tlp-badge-secondary': milestoneController.milestone.initialEffort <= milestoneController.milestone.capacity,
            }"
            translate
        >Initial effort: {{ milestoneController.milestone.initialEffort }}</span>
        <span class="tlp-badge-secondary milestone-info-badge"
            ng-if="! milestoneController.milestone.initialEffort"
            translate
        >Initial effort: N/A</span>

        <div class="milestone-spacer"></div>

        <a href="/plugins/tracker/?aid={{ milestoneController.milestone.id }}"
            ng-click="planning.showEditSubmilestoneModal($event, milestoneController.milestone)"
            title="{{::'Edit' | translate }}"
            class="milestone-info-link"
        ><i class="fa fa-edit"></i><span translate>Edit</span></a>

        <a href="{{ planning.generateMilestoneLinkUrl(milestoneController.milestone, 'details') }}"
            title="{{::'Overview' | translate }}"
            class="milestone-info-link"
        ><i class="fa fa-bar-chart"></i><span translate>Overview</span></a>

        <a href="{{ planning.generateMilestoneLinkUrl(milestoneController.milestone, 'planning-v2') }}"
            ng-if="milestoneController.milestone.resources.milestones.accept.trackers.length > 0"
            title="{{::'Planning' | translate }}"
            class="milestone-info-link"
        ><i class="fa fa-sign-in"></i><span translate>Planning</span></a>

        <a href="{{ planning.generateMilestoneLinkUrl(milestoneController.milestone, 'cardwall') }}"
            ng-if="milestoneController.milestone.resources.cardwall"
            title="{{::'Cardwall' | translate }}"
            class="milestone-info-link"
        ><i class="fa fa-table"></i><span translate>Cardwall</span></a>
    </div>

    <section class="tlp-pane-section"
        ng-show="! milestoneController.milestone.collapsed"
    >
        <div class="milestone-backlog-items submilestone"
            ng-class="{ 'empty-milestone': milestoneController.isMilestoneLoadedAndEmpty() }"
            data-accept="{{ milestoneController.milestone.content_accepted_types.toString() }}"
            data-submilestone-id="{{ milestoneController.milestone.id }}"
            data-nodrop="{{ ! milestoneController.canUserMoveCards() }}"
        >
            <div ng-repeat="backlog_item in milestoneController.milestone.content"
                class="backlog-item {{ planning.current_view_class }}"
                data-accept="{{ backlog_item.accepted_types.toString() }}"
                data-type="{{ backlog_item.trackerId }}"
                ng-show="planning.canShowBacklogItem(backlog_item)"
                collapsed="true"
                data-nodrag="{{ ! milestoneController.canUserMoveCards() }}"
                data-item-id="{{ backlog_item.id }}"
                backlog-item-index="$index"
                backlog-item-select="backlog_item"
                backlog-item
                ng-init="canUserMoveCards=milestoneController.canUserMoveCards;current_milestone=milestoneController.milestone"
            ></div>
        </div>

        <div class="milestone-content-loading" ng-if="milestoneController.milestone.loadingContent"></div>
    </section>
</div>
